:original_name: opengauss_01_0024.html

.. _opengauss_01_0024:

Connecting to an Instance over a Private Network
================================================

You can create a GaussDB instance on the console and connect from an ECS to a GaussDB instance over a private network.

Preparations
------------

If you want to connect to a database using the command-line interface (CLI), like gsql, you need to create an ECS and install gsql on it. For details, see *Elastic Cloud Server User Guide*.

.. important::

   The ECS must run EulerOS. gsql supports the following versions:

   x86: EulerOS V2.0SP5

   Kunpeng: EulerOS V2.0SP8

Configuring Security Group Rules
--------------------------------

Before accessing the DB instance, you need to add an individual IP address or IP address range to the inbound rule. For details, see :ref:`Configuring Security Group Rules <opengauss_security_group>`.

Obtaining the Driver Package
----------------------------

`Download <https://dbs-download.obs.otc.t-systems.com/rds/GaussDB_opengauss_client_tools.zip>`__ the GaussDB driver package **GaussDB_opengauss_client_tools.zip**.

Remotely Connecting to a Database
---------------------------------

#. Log in to the created ECS.

#. Upload the client tool package to the ECS and configure gsql environment variables.

   a. Log in to the client as the **root** user.

   b. Create the **/tmp/tools** directory.

      .. code-block::

         mkdir /tmp/tools

   c. Decompress the GaussDB software package **GaussDB_driver.zip**.

      **unzip GaussDB_driver.zip**

   d. Find the version of **GaussDB-Kernel-**\ *xxx*\ **-EULER-64bit-gsql.tar.gz** that corresponds to your ECS OS architecture, and upload it to the **/tmp/tools** directory of the ECS.

      .. note::

         The software package is located where you put it before installation.

   e. Decompress the package.

      .. code-block::

         cd /tmp/tools
         tar -zxvf GaussDB-Kernel-xxx-EULER-64bit-gsql.tar.gz

      Replace *xxx* with the version number of the package you have obtained.

   f. Configure environment variables.

      Open the **~/.bashrc** file.

      .. code-block::

         vi ~/.bashrc

      Press **i** to enter the INSERT mode. Type the following content, press **Esc** to exit the editing mode, and run the **:wq!** command to save the changes and exit the editor.

      .. code-block::

         export PATH=/tmp/tools/bin:$PATH

      .. code-block::

         export LD_LIBRARY_PATH=/tmp/tools/lib:$LD_LIBRARY_PATH

      Make the environment variables take effect.

      .. code-block::

         source ~/.bashrc

#. Enter the password when prompted to connect to the database.

   After an instance is created, a **postgres** database is generated by default. Database **postgres** is used as an example.

   .. code-block::

      gsql -d postgres -h 10.0.0.0 -U root -p 8000
      Password for user root:

   *postgres* indicates the database name, *10.0.0.0* indicates the CN IP address of a distributed DB instance or the primary DN IP address of a primary/standby DB instance, *root* is the username for logging in to the database, and *8000* is the port number of the CN.

.. _en-us_topic_0000002124197125__section251948884:

SSL Connection
--------------

#. Log in to the management console.

#. Click |image1| in the upper left corner and select a region and project.

#. Click |image2| in the upper left corner of the page and choose **Databases** > **GaussDB**. The GaussDB console is displayed.

#. On the **Instances** page, click the name of the target instance. In the **DB Information** area on the **Basic Information** page, click |image3| next to the **SSL** field to download the root certificate or certificate bundle.

#. Upload the root certificate to the ECS or save it to the device to be connected to the GaussDB instance.

   Import the root certificate to the Linux ECS. You can use a connection tool (such as WinSCP or PuTTY) to upload the certificate to any directory on a Linux server.

#. Connect to a GaussDB instance.

   A Linux ECS is used in this example. Run the following command to set environment variables on the ECS:

   .. code-block::

      export PGSSLMODE=<sslmode>
      export PGSSLROOTCERT=<ca-file-directory>

   **gsql -h** *<host>* **-p** *<port>* **-d** *<database>* **-U** *<user>*

   .. table:: **Table 1** Parameter description

      +-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter             | Description                                                                                                                                                                                                                                                                                                                |
      +=======================+============================================================================================================================================================================================================================================================================================================================+
      | *<host>*              | IP address of the DB instance. To obtain the IP address, click the instance name on the **Instances** page to go to the **Basic Information** page of the instance. If the DB instance is accessed through an ECS, the IP address can be found in the **Private IP Address** field of the **Connection Information** area. |
      +-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | *<port>*              | Database port in use. The default value is **8000**. To obtain this parameter, go to the **Basic Information** page of the DB instance. The port number can be found in the **Database Port** field in the **Connection Information** area.                                                                                |
      +-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | *<database>*          | Name of the database to connect to. The default management database is **postgres**.                                                                                                                                                                                                                                       |
      +-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | *<user>*              | Username of the GaussDB database account. The default administrator is **root**.                                                                                                                                                                                                                                           |
      +-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | *<ca-file-directory>* | Path of the CA certificate for SSL connection.                                                                                                                                                                                                                                                                             |
      +-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | *<sslmode>*           | SSL connection mode. Set it to **verify-ca** to verify that the server is trustworthy by checking the certificate chain.                                                                                                                                                                                                   |
      +-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   For example, to connect to a **postgres** database through an SSL connection as user **root**, run the following commands on the ECS:

   .. code-block::

      export PGSSLMODE="verify-ca"
      export PGSSLROOTCERT="/home/Ruby/ca.pem"

   **gsql** **-d** *postgres* **-h** *10.0.0.0* **-U** *root* **-p** *8000*

   .. code-block::

      Password for user root:

#. Check the command output after you log in to the database. If information similar to the following is displayed, the SSL connection has been established.

   .. code-block::

      SSL connection (cipher: DHE-RSA-AES256-GCM-SHA384, bits: 256)

.. |image1| image:: /_static/images/en-us_image_0000002088517922.png
.. |image2| image:: /_static/images/en-us_image_0000002124197217.png
.. |image3| image:: /_static/images/en-us_image_0000002088517998.png
